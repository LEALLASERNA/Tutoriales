
En Solidity, los **eventos** permiten que un contrato registre datos en la blockchain, lo que hace que esos datos sean accesibles para aplicaciones externas como **dApps** y **interfaces de usuario**. Los eventos generan logs que son almacenados en la blockchain, pero no son accesibles por los contratos inteligentes una vez emitidos, solo pueden ser leídos fuera de la cadena.

Los eventos son útiles para:

- Registrar información importante de una transacción.
- Notificar a interfaces de usuario cuando algo sucede en el contrato.
- Optimizar el uso de gas, ya que registrar eventos es más barato que almacenar datos directamente en el contrato.

## Declaración de eventos

Un evento se define utilizando la palabra clave `event`, y puede tener varios parámetros. Se pueden emitir eventos desde dentro de las funciones del contrato.

```javascript
pragma solidity ^0.8.0;

contract Eventos {
    // Definir un evento llamado 'Transferencia'
    event Transferencia(address from, address to, uint amount);
    
    function transferir(address _to, uint _amount) public {
        // Emitir el evento Transferencia
        emit Transferencia(msg.sender, _to, _amount);
    }
}
```
Se define un evento llamado `Transferencia` que tiene tres parámetros: `from` (quién envió), `to` (quién recibe), y `amount` (cantidad transferida).
El evento se **emite** dentro de la función `transferir` usando `emit`.

## Parámetros indexados (`indexed`)

Los parámetros en un evento pueden ser **indexados** para que se puedan buscar más fácilmente en los logs de la blockchain. Solo hasta tres parámetros de un evento pueden ser indexados.

```javascript
pragma solidity ^0.8.0;

contract Eventos {
    event Transferencia(address indexed from, address indexed to, uint amount);
    
    function transferir(address _to, uint _amount) public {
        emit Transferencia(msg.sender, _to, _amount);
    }
}
```
Aquí, tanto el `from` como el `to` están marcados como `indexed`, lo que significa que en los logs de la blockchain se puede filtrar fácilmente por estas direcciones.

## Cómo se ven los logs en la blockchain

Cuando se emite un evento en Solidity, se genera un **log** que se almacena en la blockchain, pero estos logs no son accesibles desde dentro de un contrato. Solo las interfaces fuera de la cadena, como **dApps**, exploradores de bloques, y herramientas como **web3.js** o **ethers.js**, pueden leer y procesar estos logs.

Los eventos son extremadamente útiles para enviar notificaciones a los usuarios o dApps que interactúan con el contrato inteligente, sin incrementar innecesariamente el costo de almacenamiento en la blockchain.

## Escuchar eventos en una dApp (con web3.js)

Cuando usas eventos en una dApp, puedes suscribirte a ellos y ejecutar acciones cuando se detecta que el evento ha sido emitido.

```javascript
const contrato = new web3.eth.Contract(abi, direccionContrato);

// Escuchar el evento Transferencia

contrato.events.Transferencia({
    filter: {to: cuentaUsuario}, // Solo los eventos donde el destinatario es "cuentaUsuario"
    fromBlock: 0
}, (error, event) => {
    console.log(event);
});
```
Este código en **JavaScript** escucha todos los eventos `Transferencia` del contrato desde el bloque 0 y filtra solo aquellos donde `to` es la dirección del usuario.

### Beneficios del uso de eventos

- **Coste de gas más bajo**: Los logs generados por eventos son más baratos que almacenar datos en variables de estado. Esto los hace ideales para generar registros o logs sin sobrecargar el contrato.
- **Facilita la depuración**: Los eventos permiten rastrear cómo se está comportando el contrato, especialmente durante el desarrollo y las pruebas.
- **Comunicación con aplicaciones fuera de la cadena**: Los eventos son el canal principal para que las aplicaciones fuera de la blockchain reciban actualizaciones o notificaciones de los contratos inteligentes.

### Limitaciones de los eventos

- **No son accesibles dentro del contrato**: Una vez que un evento es emitido, los contratos inteligentes no pueden acceder a esos datos nuevamente. Los eventos son solo para la comunicación fuera de la cadena.
- **Número limitado de parámetros indexados**: Solo se pueden indexar hasta tres parámetros, lo que puede limitar su capacidad de búsqueda si el evento tiene más de tres parámetros importantes.